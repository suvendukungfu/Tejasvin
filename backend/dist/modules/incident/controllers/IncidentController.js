"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.IncidentController = void 0;
const IncidentService_1 = require("../services/IncidentService");
class IncidentController {
    constructor() {
        this.incidentService = new IncidentService_1.IncidentService();
    }
    async create(req, res) {
        try {
            const { type, description, lat, lng } = req.body;
            const incident = await this.incidentService.createIncident({
                victimId: req.user.id,
                type,
                description,
                location: {
                    type: 'Point',
                    coordinates: [lng, lat]
                }
            });
            res.status(201).json(incident);
        }
        catch (err) {
            console.error(err.message);
            res.status(500).send('Server Error');
        }
    }
    async getActive(_req, res) {
        try {
            const incidents = await this.incidentService.getActiveIncidents();
            res.json(incidents);
        }
        catch (err) {
            console.error(err.message);
            res.status(500).send('Server Error');
        }
    }
    async updateVitals(req, res) {
        try {
            const { status, heartRate, notes } = req.body;
            const incident = await this.incidentService.updateVitals(req.params.id, {
                status,
                heartRate,
                notes
            });
            if (!incident) {
                res.status(404).json({ msg: 'Incident not found' });
                return;
            }
            res.json(incident);
        }
        catch (err) {
            console.error(err.message);
            res.status(500).send('Server Error');
        }
    }
}
exports.IncidentController = IncidentController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5jaWRlbnRDb250cm9sbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL21vZHVsZXMvaW5jaWRlbnQvY29udHJvbGxlcnMvSW5jaWRlbnRDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLGlFQUE4RDtBQUU5RCxNQUFhLGtCQUFrQjtJQUczQjtRQUNJLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxpQ0FBZSxFQUFFLENBQUM7SUFDakQsQ0FBQztJQUVNLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBWSxFQUFFLEdBQWE7UUFDM0MsSUFBSSxDQUFDO1lBQ0QsTUFBTSxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDakQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQztnQkFDdkQsUUFBUSxFQUFHLEdBQVcsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDOUIsSUFBSTtnQkFDSixXQUFXO2dCQUNYLFFBQVEsRUFBRTtvQkFDTixJQUFJLEVBQUUsT0FBTztvQkFDYixXQUFXLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDO2lCQUMxQjthQUNKLENBQUMsQ0FBQztZQUNILEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1lBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7SUFDTCxDQUFDO0lBRU0sS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFhLEVBQUUsR0FBYTtRQUMvQyxJQUFJLENBQUM7WUFDRCxNQUFNLFNBQVMsR0FBRyxNQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUNsRSxHQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3hCLENBQUM7UUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1lBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7SUFDTCxDQUFDO0lBRU0sS0FBSyxDQUFDLFlBQVksQ0FBQyxHQUFZLEVBQUUsR0FBYTtRQUNqRCxJQUFJLENBQUM7WUFDRCxNQUFNLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBQzlDLE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFZLEVBQUU7Z0JBQzlFLE1BQU07Z0JBQ04sU0FBUztnQkFDVCxLQUFLO2FBQ1IsQ0FBQyxDQUFDO1lBQ0gsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUNaLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLG9CQUFvQixFQUFFLENBQUMsQ0FBQztnQkFDcEQsT0FBTztZQUNYLENBQUM7WUFDRCxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZCLENBQUM7UUFBQyxPQUFPLEdBQVEsRUFBRSxDQUFDO1lBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7SUFDTCxDQUFDO0NBQ0o7QUF0REQsZ0RBc0RDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IEluY2lkZW50U2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL0luY2lkZW50U2VydmljZSc7XG5cbmV4cG9ydCBjbGFzcyBJbmNpZGVudENvbnRyb2xsZXIge1xuICAgIHByaXZhdGUgaW5jaWRlbnRTZXJ2aWNlOiBJbmNpZGVudFNlcnZpY2U7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5pbmNpZGVudFNlcnZpY2UgPSBuZXcgSW5jaWRlbnRTZXJ2aWNlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFzeW5jIGNyZWF0ZShyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHsgdHlwZSwgZGVzY3JpcHRpb24sIGxhdCwgbG5nIH0gPSByZXEuYm9keTtcbiAgICAgICAgICAgIGNvbnN0IGluY2lkZW50ID0gYXdhaXQgdGhpcy5pbmNpZGVudFNlcnZpY2UuY3JlYXRlSW5jaWRlbnQoe1xuICAgICAgICAgICAgICAgIHZpY3RpbUlkOiAocmVxIGFzIGFueSkudXNlci5pZCxcbiAgICAgICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIGxvY2F0aW9uOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdQb2ludCcsXG4gICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBbbG5nLCBsYXRdXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbihpbmNpZGVudCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKGVyci5tZXNzYWdlKTtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNTAwKS5zZW5kKCdTZXJ2ZXIgRXJyb3InKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBnZXRBY3RpdmUoX3JlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgaW5jaWRlbnRzID0gYXdhaXQgdGhpcy5pbmNpZGVudFNlcnZpY2UuZ2V0QWN0aXZlSW5jaWRlbnRzKCk7XG4gICAgICAgICAgICByZXMuanNvbihpbmNpZGVudHMpO1xuICAgICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZCgnU2VydmVyIEVycm9yJyk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwdWJsaWMgYXN5bmMgdXBkYXRlVml0YWxzKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyBzdGF0dXMsIGhlYXJ0UmF0ZSwgbm90ZXMgfSA9IHJlcS5ib2R5O1xuICAgICAgICAgICAgY29uc3QgaW5jaWRlbnQgPSBhd2FpdCB0aGlzLmluY2lkZW50U2VydmljZS51cGRhdGVWaXRhbHMocmVxLnBhcmFtcy5pZCBhcyBzdHJpbmcsIHtcbiAgICAgICAgICAgICAgICBzdGF0dXMsXG4gICAgICAgICAgICAgICAgaGVhcnRSYXRlLFxuICAgICAgICAgICAgICAgIG5vdGVzXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmICghaW5jaWRlbnQpIHtcbiAgICAgICAgICAgICAgICByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1zZzogJ0luY2lkZW50IG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzLmpzb24oaW5jaWRlbnQpO1xuICAgICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIubWVzc2FnZSk7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDUwMCkuc2VuZCgnU2VydmVyIEVycm9yJyk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=